include include/header-sondage
extends include/layout
block content
    div(ng-app='pages.sondage', ng-controller="SondageControleur")
        mixin headerSondage(true)

        ul.nav.nav-tabs
            li.active
                a(href="#participate", data-toggle="tab") Participate
            li(ng-show="afficheVote()")
                a(href="#votes", data-toggle="tab")
                    | Existing votes &nbsp;
                    span.badge.badge-info(ng-bind="nombreVotes")
            li(ng-show="sondage.withComments")
                a(href="#disqus_thread", data-disqus-identifier="{{disqus_identifier}}", data-toggle="tab") Comments
        .tab-content
            .tab-pane.active#participate(ng-controller="VoteControleur")
                div(loader="propositionsChargees")
                .alert.alert-warning(ng-show="!votePossible()", ng-cloak)
                    | No proposals for this poll yet
                form(ng-submit="valideVote()", ng-show="votePossible()")
                    label Proceed with your vote !
                    .row(ng-cloak)
                        .row.participation.col-md-8.col-md-offset-2
                            .col-md-6
                                label
                                    span.label.label-primary 1
                                    | &nbsp;Pick proposals
                                ul.list-group
                                    li.list-group-item(ng-repeat="proposition in propositions")
                                        h5.list-group-item-heading.text-info
                                            strong {{proposition.label}}
                                        p.list-group-item-text
                                            button.btn.btn-info(ng-click="votePour(proposition)", type="button")
                                                | Select
                                                span.glyphicon.glyphicon-chevron-right


                            .col-md-6
                                label
                                    span.label.label-primary 2
                                    | &nbsp;Order them
                                ul.list-group
                                    li.list-group-item(ng-repeat="proposition in vote.proposals")
                                        h5.list-group-item-heading.text-success
                                            strong {{proposition.label}}
                                        p.list-group-item-text
                                            .btn-group
                                                button.btn.btn-info(type="button", ng-click="annuleVotePour(proposition)")
                                                    span.glyphicon.glyphicon-chevron-left
                                                    | Unselect
                                                button.btn.btn-default(type="button", ng-if="!$first", ng-click="monte(proposition)")
                                                    span.glyphicon.glyphicon-chevron-up
                                                button.btn.btn-default(type="button", ng-if="!$last", ng-click="descend(proposition)")
                                                    span.glyphicon.glyphicon-chevron-down
                    .row.col-md-offset-4
                        .col-md-6.action
                            label
                                span.label.label-primary 3
                            | &nbsp; Enter your name and vote !
                            .input-group
                                input.form-control(type="text", placeholder="Enter name or nickname", ng-model="vote.name")
                                span.input-group-btn
                                    button(type="submit", loading="Vote...", ng-disabled="creation").btn.btn-primary Vote !
            .tab-pane#votes(ng-show="afficheVote()", ng-controller="VotesSondageControleur")
                span(ng-show="votes.length == 0") No vote yet
                table.table(ng-show="votes.length > 0")
                    thead
                        tr
                            th Participant
                            th Vote
                    tbody
                        tr(ng-repeat="vote in votes")
                            td(ng-bind="vote.participant || 'Anonymous'")
                            td
                                span(ng-repeat="choix in vote.choices")
                                    | {{choix}}
                                    span(ng-if="!$last"),Â 

            .tab-pane(ng-if="sondage.withComments", disqus)

block js
    != nap.js("sondage")
    script(type="text/javascript").
        var switchTo5x=true;

    script(type="text/javascript", src="http://w.sharethis.com/button/buttons.js")

    script(type="text/javascript").
        stLight.options({publisher: "666009eb-0a92-4a94-a03d-abeabcba8f41", doNotHash: false, doNotCopy: false, hashAddressBar: false});